(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d7609"],{"770c":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h1",{attrs:{id:"greetings"}},[e._v("你好,")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),s("el-button",{nativeOn:{click:function(t){return t.preventDefault(),e.sendMessage(t)}}},[e._v("发送")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.buttonVisible,expression:"buttonVisible"},{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"match"},nativeOn:{click:function(t){return t.preventDefault(),e.match(t)}}},[e._v("点击匹配")]),s("div",{staticClass:"textarea scroll",attrs:{id:"responseContent"}}),s("div",{attrs:{id:"output"}})],1)},i=[],o=s("c24f"),a=s("5f87"),r=s("b775"),c=s("5c96");function u(){return Object(r["a"])({url:"/api/battle/questions",method:"get"})}var d={name:"Socket",data:function(){return{message:"",socket:"",me:null,loading:!1,buttonVisible:!0,questions:[],PRIVATE_CHAT_MESSAGE_CODE:1,GROUP_CHAT_MESSAGE_CODE:2,PING_MESSAGE_CODE:3,SYSTEM_MESSAGE_CODE:5,MATCHING_MESSAGE_CODE:6,MATCH_SUCCESS_MESSAGE_CODE:7,MATCH_REVOKE_CODE:8,LOGIN_CODE:1e3,LOGOUT_CODE:1001}},destroyed:function(){this.quitSend(),location.reload()},created:function(){this.initMe()},methods:{initMe:function(){var e=this;this.me=new Object,Object(o["b"])(Object(a["a"])()).then((function(t){e.me.username=t.data.userNickname,e.me.userId=t.data.userName,e.websocket()}))},websocket:function(){var e=this;return window.WebSocket?(this.socket=new WebSocket(r["b"]+this.me.userId),console.log("当前用户是"+this.me.username),document.getElementById("greetings").append(decodeURI(decodeURI(this.me.username))),this.socket.onmessage=function(t){var s=JSON.parse(t.data);switch(console.log(JSON.stringify(s)),s.code){case e.GROUP_CHAT_MESSAGE_CODE:document.getElementById("output").append(s.msg);break;case e.SYSTEM_MESSAGE_CODE:break;case e.PING_MESSAGE_CODE:e.sendPong();break;case e.PRIVATE_CHAT_MESSAGE_CODE:break;case e.MATCH_SUCCESS_MESSAGE_CODE:c["MessageBox"].close(),e.loading=!1,e.buttonVisible=!1,e.$message({type:"success",message:"匹配成功"}),e.getQuestion();break;case e.MATCH_REVOKE_CODE:c["MessageBox"].close(),e.loading=!1,e.$message({type:"error",message:"没有找到对手捏，请稍后重新匹配~"})}},this.socket.onopen=function(){e.loginSend()},this.socket.onclose=function(){e.quitSend()},!0):(alert("您的浏览器不支持WebSocket"),!1)},sendPong:function(){var e={code:4};this.send(JSON.stringify(e))},send:function(e){window.WebSocket&&(this.socket.readyState===WebSocket.OPEN||(this.socket.readyState=WebSocket.OPEN),this.socket.send(e))},loginSend:function(){var e={};e.code=this.LOGIN_CODE,e.username=this.me.username,e.userId=this.me.userId,this.send(JSON.stringify(e))},quitSend:function(){var e={};e.code=this.LOGOUT_CODE,e.username=this.me.username,e.userId=this.me.userId,this.send(JSON.stringify(e))},sendMessage:function(){if(""!==this.message&&null!=this.message){var e={};e.code=this.GROUP_CHAT_MESSAGE_CODE,e.username=this.me.username,e.msg=this.message,e.sendUserId=this.me.userId,this.send(JSON.stringify(e))}else alert("信息不能为空~")},match:function(){var e=this;this.loading=!0,c["MessageBox"].confirm("匹配中......","对战练习",{confirmButtonText:"隐藏",cancelButtonText:"取消",type:"info"}).then((function(){e.$message({type:"info",message:"正在帮您匹配，匹配框已帮您自动隐藏"})})).catch((function(){e.loading=!1,e.revokeMatch(),e.$message({type:"error",message:"已取消匹配"})}));var t={};t.code=this.MATCHING_MESSAGE_CODE,t.username=this.me.username,t.sendUserId=this.me.userId,console.log(JSON.stringify(t)),this.send(JSON.stringify(t))},revokeMatch:function(){var e={};e.code=this.MATCH_REVOKE_CODE,e.username=this.me.username,e.sendUserId=this.me.userId,console.log(JSON.stringify(e)),this.send(JSON.stringify(e))},getQuestion:function(){var e=this;u().then((function(t){e.questions=t.questions,console.log("大的要来了"),console.log(e.questions[0])}))}}},m=d,l=s("2877"),g=Object(l["a"])(m,n,i,!1,null,"11dda9bc",null);t["default"]=g.exports}}]);